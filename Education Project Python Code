import pandas as pd
#import data and put into data frame
staff = pd.read_excel(f"F:\Data Science\Data for Projects\Project_3_Education_Demographic\stage_data.xlsx",
                     sheet_name='staff_stage')

df_staff = pd.DataFrame(staff)

#Checking data types

df_staff.info()

#Convert cds components into strings to build cds value for joins
dtype_map = {'County Code':'str', 'District Code': 'str', 'School Code': 'str'}
df2 = df_staff.astype(dtype_map)

#Add 0 to School Codes that are 6 digits to account for cds structure
df2['School Code'] = df2['School Code'].apply(lambda x: '0' + x if len(x) == 6 else x)
df2['cds'] = df2['County Code'] + df2['District Code'] + df2['School Code']

#cast to int type
df2['cds'] = df2['cds'].astype(int)

#melt to "tidy" data for joins
df3 = df2.melt(id_vars=['cds','Total Staff Count'],
              value_vars=['AA','AI','AS','FI','HI','PI','WH','MR','NP' ],
              var_name='teacher_group',
              value_name='sub_staff_count')


df3.to_excel(f"F:\Data Science\Data for Projects\Project_3_Education_Demographic\stage_staff.xlsx", sheet_name='staff', index=False)
